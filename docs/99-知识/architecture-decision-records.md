# 架构决策记录

**文档编号**: KB-002
**创建时间**: 2025-11-26 15:00
**最后修改**: 2025-11-26 15:00
**执行模型**: claude-opus-4-1 (claude-opus-4-1-20250805)
**文档状态**: 生效中

---

## 修改历史

| 日期 | 修改人/模型 | 修改概要 |
|------|------------|---------|
| 2025-11-26 15:00 | claude-opus-4-1 | 从archived目录迁移并重新整理 |
| 2025-01-14 | 开发团队 | 原始评审记录 |

---

## 架构决策记录 (ADR)

本文档记录项目重要的架构决策历史，帮助团队理解技术选择的原因和演进过程。

---

## ADR-001: 通用化改造方案选择 (2025-01-14)

### 背景

项目需要从港口航运专用系统改造为跨行业通用平台。

### 评审的方案

#### 方案 v1.0 - Entity重写方案
- 引入Entity/EntityTemplate等新概念
- 重写数据模型
- 全面重构系统

#### 方案 v2.0 - 场景适配层方案
- 保持现有Document/Form数据模型
- 增加场景适配层
- 渐进式改造

### 决策

选择 **v2.0 场景适配层方案**

### 决策原因

#### v1.0方案的问题
1. **概念混乱** - Entity vs Document vs FormInstance 概念不清
2. **过度设计** - 引入过多抽象层（Engine、Manager、Registry等）
3. **数据模型缺陷** - 字段从13个增加到40+个，customFields失去类型安全
4. **技术错误** - eval()安全漏洞，验证逻辑错误
5. **配置复杂** - 单个场景配置高达1677行JSON
6. **时间估算错误** - 声称16周完成，实际需6-12个月
7. **兼容性差** - 使用 `as any` 绕过类型检查

#### v2.0方案的优势
1. **零风险启动** - POC只需4周
2. **快速见效** - 第10周第一个场景即可上线
3. **技术简单** - 没有复杂抽象层，易于理解
4. **配置精简** - 50-150行/场景
5. **100%向后兼容** - 现有功能不受影响

### 经验教训

1. **避免过度工程化** - 简单的解决方案往往更好
2. **POC先行** - 验证可行性再全面实施
3. **渐进式改造** - 小步快跑，持续交付
4. **保持向后兼容** - 减少迁移成本和风险

### 后续发展

#### 产品化改造方案 v3.0
基于v2.0的经验，提出更彻底的产品化改造：
- **字段动态化** - 数据库层面支持
- **配置驱动** - Spring Boot配置体系
- **Connector架构** - 外部系统集成

### 相关文档

- 当前实施方案：`docs/02-需求/PRODUCT_TRANSFORMATION_PLAN.md`
- 改造概览：`docs/02-需求/TRANSFORMATION_OVERVIEW.md`
- 实施任务：`docs/05-实现/KICKOFF_TASKS.md`

---

## ADR-002: TypeScript严格模式 (2025-01)

### 背景

项目存在大量 `any` 类型使用，影响类型安全。

### 决策

启用TypeScript严格模式，避免使用 `any`。

### 决策原因

1. **类型安全** - 编译时发现错误
2. **IDE支持** - 更好的代码提示
3. **维护性** - 代码更容易理解

### 实施

- 使用 `unknown` 替代 `any`
- 使用 `interface` 定义数据类型
- 所有函数明确参数和返回类型

---

## ADR-003: React函数组件优先 (2025-01)

### 背景

需要统一组件开发模式。

### 决策

使用函数组件 + Hooks，不再使用类组件。

### 决策原因

1. **简洁性** - 代码更简洁
2. **性能** - 配合React.memo等优化
3. **趋势** - React官方推荐

### 实施

- 新组件使用函数组件
- 旧组件渐进式重构
- 自定义Hook以 `use` 开头

---

## 架构原则

基于以上决策，项目遵循以下架构原则：

### 1. 简单优先
- 优先选择简单的解决方案
- 避免过度设计和过早优化
- 保持代码可读性

### 2. 渐进式改造
- 小步快跑，持续交付
- POC验证，降低风险
- 保持向后兼容

### 3. 配置驱动
- 业务逻辑通过配置实现
- 减少硬编码
- 提高灵活性

### 4. 类型安全
- TypeScript严格模式
- 避免any类型
- 完整的类型定义

---

## 未来考虑

### 待评估的技术选择

1. **微前端架构** - 支持多团队独立开发
2. **GraphQL** - 更灵活的API查询
3. **服务端渲染(SSR)** - 提升首屏性能
4. **WebAssembly** - 高性能计算场景

### 持续改进

- 每季度进行架构评审
- 记录重要技术决策
- 分享经验教训

---

**本文档持续更新，记录项目架构演进历程。**