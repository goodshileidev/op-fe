# é€šç”¨åŒ–æ”¹é€ æ€»è§ˆï¼ˆä¿®è®¢ç‰ˆ v2.0ï¼‰

> **æ ¸å¿ƒç†å¿µ**: æ¸è¿›å¼æ”¹é€ ï¼Œåœºæ™¯é€‚é…ä¼˜äºé‡å†™ï¼Œé…ç½®é©±åŠ¨ä¼˜äºç¡¬ç¼–ç 

---

## ğŸ“‹ ä¿®è®¢è¯´æ˜

**v2.0 (2025-01-14)**:
- âŒ æ”¾å¼ƒ"Entity"æ¦‚å¿µï¼Œä¿æŒç°æœ‰ Document/Form æ•°æ®æ¨¡å‹
- âœ… é‡‡ç”¨"åœºæ™¯é€‚é…å±‚"è€Œéé‡å†™æ•°æ®æ¨¡å‹
- âœ… æ˜ç¡® POC å…ˆè¡Œï¼Œæ¸è¿›å¼æ”¹é€ 
- âœ… ä¿®æ­£æ—¶é—´ä¼°ç®—å’ŒæŠ€æœ¯æ–¹æ¡ˆ
- âœ… è§£å†³æ¦‚å¿µæ··ä¹±å’Œé€»è¾‘å†²çª

---

## ğŸ¯ æ”¹é€ ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

å°†ç°æœ‰çš„**æ¸¯å£èˆªè¿è¡¨å•ç®¡ç†ç³»ç»Ÿ**æ”¹é€ ä¸º**è·¨è¡Œä¸šé€šç”¨çš„æ•°æ®æ”¶é›†å’Œç®¡ç†å¹³å°**ã€‚

### æ”¹é€ åŸåˆ™

1. **ä¿æŒæ ¸å¿ƒæ•°æ®æ¨¡å‹ä¸å˜** - ä¸é‡å†™ Document/Form/Template
2. **åœºæ™¯é€‚é…å±‚** - é€šè¿‡é€‚é…å±‚è€Œéé‡æ„å®ç°é€šç”¨åŒ–
3. **POC éªŒè¯ä¼˜å…ˆ** - æ¯ä¸ªæ–°åœºæ™¯å…ˆåšæ¦‚å¿µéªŒè¯
4. **æ¸è¿›å¼äº¤ä»˜** - æ¯2-4å‘¨äº¤ä»˜å¯ç”¨åŠŸèƒ½
5. **å‘åå…¼å®¹100%** - ç°æœ‰åŠŸèƒ½é›¶å½±å“

### ä¸šåŠ¡ä»·å€¼

| ç»´åº¦ | æ”¹é€ å‰ | æ”¹é€ åï¼ˆä¿å®ˆä¼°è®¡ï¼‰ | æå‡ |
|------|--------|----------|------|
| **è¡Œä¸šè¦†ç›–** | 1ä¸ª | 3-5ä¸ª | 3-5å€ |
| **æ–°åœºæ™¯å¼€å‘** | 2-4å‘¨ | 5-10å¤© | 50-70%â†“ |
| **å®šåˆ¶æˆæœ¬** | é«˜ï¼ˆéœ€å¼€å‘ï¼‰ | ä¸­ï¼ˆé…ç½®+å°‘é‡å¼€å‘ï¼‰ | 40-60%â†“ |
| **ä»£ç é‡ç”¨ç‡** | 20% | 60-80% | 3-4å€ |

---

## ğŸ—ï¸ æ ¸å¿ƒè®¾è®¡

### 1. ä¿æŒç°æœ‰æ•°æ®æ¨¡å‹

**NOT** å¼•å…¥ Entity/EntityTemplate/EntityField ç­‰æ–°æ¦‚å¿µã€‚

**ä¿æŒç°æœ‰å±‚æ¬¡**:
```
DocumentTemplate (æ–‡æ¡£æ¨¡æ¿)
    â†“ 1:1
DocumentTemplateVersion (æ–‡æ¡£æ¨¡æ¿ç‰ˆæœ¬)
    â†“ 1:N
Document (æ–‡æ¡£å®ä¾‹) - å®¹å™¨
    â†“ 1:N
Form (è¡¨å•å®ä¾‹) - çœŸæ­£çš„æ•°æ®
    â†“ 1:N
FormSection (è¡¨å•åŒºå—)
    â†“ 1:N
FormQuestion (è¡¨å•é—®é¢˜)
```

**ä¼˜åŠ¿**:
- âœ… é›¶æ•°æ®è¿ç§»æˆæœ¬
- âœ… ç°æœ‰ä»£ç ç»§ç»­å·¥ä½œ
- âœ… é™ä½é£é™©
- âœ… æ˜“äºç†è§£

### 2. åœºæ™¯é€‚é…å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç”¨æˆ·ç•Œé¢å±‚ (UI)                        â”‚
â”‚        åœºæ™¯æ— å…³çš„é€šç”¨ç»„ä»¶ + åœºæ™¯é€‰æ‹©å™¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åœºæ™¯é€‚é…å±‚ (Scenario Adapter)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åœºæ™¯æ³¨å†Œè¡¨ (ScenarioRegistry)                 â”‚   â”‚
â”‚  â”‚ - åŒ»ç–—åœºæ™¯é…ç½®                                â”‚   â”‚
â”‚  â”‚ - å·¡æ£€åœºæ™¯é…ç½®                                â”‚   â”‚
â”‚  â”‚ - æ¸¯å£åœºæ™¯é…ç½®ï¼ˆå½“å‰ï¼‰                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åœºæ™¯é€‚é…å™¨ (ScenarioAdapter)                  â”‚   â”‚
â”‚  â”‚ - å­—æ®µæ˜ å°„ (FieldMapper)                      â”‚   â”‚
â”‚  â”‚ - æœ¯è¯­ç¿»è¯‘ (TermTranslator)                   â”‚   â”‚
â”‚  â”‚ - UIé…ç½® (UIConfigurator)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç°æœ‰ä¸šåŠ¡é€»è¾‘å±‚ (ä¿æŒä¸å˜)                    â”‚
â”‚  DocumentService / FormService / TemplateService    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç°æœ‰æ•°æ®å±‚ (ä¿æŒä¸å˜)                        â”‚
â”‚  Document / Form / FormQuestion / FormSection       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ€æƒ³**: åœ¨ç°æœ‰ç³»ç»Ÿä¹‹ä¸ŠåŠ ä¸€å±‚é€‚é…ï¼Œè€Œä¸æ˜¯é‡å†™åº•å±‚ã€‚

### 3. åœºæ™¯é…ç½®æ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

```typescript
/**
 * åœºæ™¯é…ç½® - è½»é‡çº§è®¾è®¡
 */
interface ScenarioConfig {
  id: string;                    // 'medical' | 'inspection' | 'shipping'
  name: string;                  // 'åŒ»ç–—è°ƒç ”' | 'å·¥ä¸šå·¡æ£€' | 'æ¸¯å£èˆªè¿'

  // å­—æ®µæ˜ å°„ï¼šé€šç”¨å­—æ®µ â†’ åœºæ™¯è¯­ä¹‰
  fieldSemantics: {
    // Document çº§åˆ«çš„å­—æ®µè¯­ä¹‰
    document: {
      documentNo: string;        // 'ç—…å†ç¼–å·' | 'å·¡æ£€å•å·' | 'ä½œä¸šå•å·'
      // å…¶ä»–å­—æ®µ...
    };
    // Form çº§åˆ«çš„å­—æ®µè¯­ä¹‰
    form: {
      [formType: string]: {
        [fieldPath: string]: string;
      };
    };
  };

  // æœ¯è¯­ç¿»è¯‘
  terminology: {
    document: string;            // 'ç—…å†' | 'å·¡æ£€è®°å½•' | 'ä½œä¸šæ–‡æ¡£'
    form: string;                // 'è¯Šç–—è¡¨å•' | 'æ£€æŸ¥è¡¨å•' | 'ä½œä¸šè¡¨å•'
    template: string;            // 'ç—…å†æ¨¡æ¿' | 'å·¡æ£€æ¨¡æ¿' | 'ä½œä¸šæ¨¡æ¿'
    // ... å…¶ä»–æœ¯è¯­
  };

  // UI é…ç½®
  ui: {
    theme: {
      primaryColor: string;      // '#1890ff' | '#52c41a' | '#fa8c16'
      icon: string;              // 'MedicineBoxOutlined' | 'ToolOutlined'
    };
    layout?: {
      tableColumns?: string[];   // åˆ—è¡¨é¡µæ˜¾ç¤ºå“ªäº›åˆ—
      searchFields?: string[];   // æœç´¢æ æ˜¾ç¤ºå“ªäº›å­—æ®µ
    };
  };

  // è§’è‰²æ˜ å°„ï¼ˆå¯é€‰ï¼‰
  roles?: {
    [genericRole: string]: {
      name: string;              // 'åŒ»ç”Ÿ' | 'å·¡æ£€å‘˜' | 'ä½œä¸šå‘˜'
      permissions: string[];
    };
  };
}
```

**å¤§å°**: é¢„è®¡ 50-150 è¡Œ JSONï¼Œè€Œé 1677 è¡Œï¼

### 4. å­—æ®µæ˜ å°„æœºåˆ¶

**é—®é¢˜**: Document ä¸­çš„ `documentNo` åœ¨ä¸åŒåœºæ™¯æœ‰ä¸åŒå«ä¹‰ã€‚

**è§£å†³æ–¹æ¡ˆ**: å­—æ®µè¯­ä¹‰æ˜ å°„

```typescript
/**
 * å­—æ®µæ˜ å°„å™¨
 */
class FieldMapper {
  constructor(private scenario: ScenarioConfig) {}

  /**
   * è·å–å­—æ®µçš„æ˜¾ç¤ºæ ‡ç­¾
   */
  getFieldLabel(entity: 'document' | 'form', fieldPath: string, formType?: string): string {
    if (entity === 'document') {
      return this.scenario.fieldSemantics.document[fieldPath]
        || fieldPath;  // å›é€€åˆ°å­—æ®µå
    }

    if (entity === 'form' && formType) {
      return this.scenario.fieldSemantics.form[formType]?.[fieldPath]
        || fieldPath;
    }

    return fieldPath;
  }

  /**
   * è·å–æœ¯è¯­ç¿»è¯‘
   */
  getTerm(key: string): string {
    return this.scenario.terminology[key] || key;
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// åœ¨æ¸¯å£åœºæ™¯
const mapper = new FieldMapper(shippingScenario);
mapper.getFieldLabel('document', 'documentNo');  // â†’ 'ä½œä¸šå•å·'
mapper.getTerm('document');                      // â†’ 'ä½œä¸šæ–‡æ¡£'

// åœ¨åŒ»ç–—åœºæ™¯
const mapper = new FieldMapper(medicalScenario);
mapper.getFieldLabel('document', 'documentNo');  // â†’ 'ç—…å†ç¼–å·'
mapper.getTerm('document');                      // â†’ 'ç—…å†'
```

**å…³é”®ç‚¹**:
- âœ… å­—æ®µåä¸å˜ï¼ˆä»ç„¶æ˜¯ `documentNo`ï¼‰
- âœ… åªæ”¹å˜æ˜¾ç¤ºæ ‡ç­¾
- âœ… ä»£ç é€»è¾‘æ— éœ€ä¿®æ”¹
- âœ… ç±»å‹å®‰å…¨ä¿æŒ

---

## ğŸ—ºï¸ å®æ–½è·¯çº¿å›¾ï¼ˆä¿®è®¢ç‰ˆï¼‰

### æ€»ä½“ç­–ç•¥: POC â†’ æ¨å¹¿ â†’ ä¼˜åŒ–

```
é˜¶æ®µ0: POC          é˜¶æ®µ1: åŒ»ç–—åœºæ™¯     é˜¶æ®µ2: å·¡æ£€åœºæ™¯     é˜¶æ®µ3: ä¼˜åŒ–æŠ½è±¡
[4å‘¨]              [6å‘¨]             [4å‘¨]             [6å‘¨]
  â†“                  â†“                  â†“                  â†“
éªŒè¯å¯è¡Œæ€§          å®Œæ•´å®ç°           å¤åˆ¶ç»éªŒ           æç‚¼é€šç”¨æ¡†æ¶
å¿«é€Ÿè¿­ä»£            ç”¨æˆ·éªŒæ”¶           å¿«é€Ÿäº¤ä»˜           æ€§èƒ½ä¼˜åŒ–
```

### é˜¶æ®µ 0: POC éªŒè¯ (4å‘¨)

**ç›®æ ‡**: éªŒè¯"åœºæ™¯é€‚é…å±‚"æ–¹æ¡ˆçš„å¯è¡Œæ€§

#### Week 1-2: è®¾è®¡å’ŒåŸå‹

**ä»»åŠ¡**:
- [x] è®¾è®¡ç®€åŒ–çš„ ScenarioConfig æ•°æ®ç»“æ„
- [x] å®ç° FieldMapper å’Œ TermTranslator
- [x] é€‰æ‹©æœ€ç®€å•çš„æ–°åœºæ™¯ï¼ˆå¦‚"è®¾å¤‡å·¡æ£€è¡¨"ï¼‰
- [x] åˆ›å»ºåŸå‹é¡µé¢ï¼ˆä¸ä¿®æ”¹ç°æœ‰ä»£ç ï¼‰

**äº¤ä»˜ç‰©**:
- `src/scenarios/types.ts` - åœºæ™¯é…ç½®ç±»å‹å®šä¹‰
- `src/scenarios/adapters/FieldMapper.ts` - å­—æ®µæ˜ å°„å™¨
- `src/scenarios/configs/inspection-poc.json` - POC åœºæ™¯é…ç½®ï¼ˆ<100è¡Œï¼‰
- `src/pages/scenarios/inspection-poc/` - POC é¡µé¢ï¼ˆå¤ç”¨ç°æœ‰ç»„ä»¶ï¼‰

#### Week 3-4: éªŒè¯å’Œè¯„ä¼°

**ä»»åŠ¡**:
- [x] å®ç° POC çš„å®Œæ•´æµç¨‹ï¼ˆåˆ›å»º/ç¼–è¾‘/æŸ¥çœ‹/åˆ—è¡¨ï¼‰
- [x] æ€§èƒ½æµ‹è¯•ï¼ˆå¯¹æ¯”åŸç”Ÿé¡µé¢ï¼‰
- [x] ä»£ç å¤ç”¨ç‡è¯„ä¼°
- [x] ç”¨æˆ·è¯•ç”¨å’Œåé¦ˆ

**æˆåŠŸæ ‡å‡†**:
- âœ… POC é¡µé¢åŠŸèƒ½å®Œæ•´
- âœ… æ€§èƒ½æŸè€— < 10%
- âœ… ä»£ç å¤ç”¨ç‡ > 60%
- âœ… ç”¨æˆ·åé¦ˆç§¯æï¼ˆ>= 4/5ï¼‰

**å†³ç­–ç‚¹**:
- å¦‚æœæˆåŠŸ â†’ è¿›å…¥é˜¶æ®µ1
- å¦‚æœå¤±è´¥ â†’ è°ƒæ•´æ–¹æ¡ˆï¼Œé‡æ–° POC

### é˜¶æ®µ 1: åŒ»ç–—åœºæ™¯å®Œæ•´å®ç° (6å‘¨)

**å‰æ**: POC æˆåŠŸ

#### Week 5-7: åœºæ™¯é…ç½®å’Œé¡µé¢å¼€å‘

**ä»»åŠ¡**:
- [ ] éœ€æ±‚è°ƒç ”ï¼ˆåŒ»ç–—è¡Œä¸šï¼‰
- [ ] è®¾è®¡åŒ»ç–—åœºæ™¯é…ç½®
- [ ] åˆ›å»ºåŒ»ç–—åœºæ™¯æ¨¡æ¿
- [ ] å¼€å‘åŒ»ç–—åœºæ™¯é¡µé¢ï¼ˆåŸºäº POC ç»éªŒï¼‰
- [ ] å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**:
- `scenarios/medical.config.json` - åŒ»ç–—åœºæ™¯é…ç½®
- `src/pages/scenarios/medical/` - åŒ»ç–—åœºæ™¯é¡µé¢
- æµ‹è¯•ç”¨ä¾‹

#### Week 8-10: é›†æˆå’Œä¼˜åŒ–

**ä»»åŠ¡**:
- [ ] é›†æˆåˆ°ä¸»åº”ç”¨
- [ ] åœºæ™¯åˆ‡æ¢åŠŸèƒ½
- [ ] æƒé™é…ç½®
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·åŸ¹è®­

**äº¤ä»˜ç‰©**:
- åœºæ™¯åˆ‡æ¢å™¨ç»„ä»¶
- ç”¨æˆ·æ–‡æ¡£
- éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

### é˜¶æ®µ 2: å·¡æ£€åœºæ™¯å¿«é€Ÿå¤åˆ¶ (4å‘¨)

**ç›®æ ‡**: éªŒè¯æ–¹æ¡ˆçš„å¯å¤åˆ¶æ€§

#### Week 11-12: åœºæ™¯å¼€å‘

åŸºäºé˜¶æ®µ1çš„ç»éªŒï¼Œå¿«é€Ÿå¼€å‘å·¡æ£€åœºæ™¯ã€‚

#### Week 13-14: æµ‹è¯•å’Œä¸Šçº¿

é›†æˆæµ‹è¯•ã€ç”¨æˆ·éªŒæ”¶ã€ç”Ÿäº§éƒ¨ç½²ã€‚

### é˜¶æ®µ 3: é€šç”¨æ¡†æ¶æç‚¼ (6å‘¨)

**ç›®æ ‡**: ä»2-3ä¸ªåœºæ™¯ä¸­æç‚¼é€šç”¨æ¡†æ¶

#### Week 15-17: æ¡†æ¶æŠ½è±¡

**ä»»åŠ¡**:
- [ ] åˆ†æå·²æœ‰åœºæ™¯çš„å…±æ€§
- [ ] æç‚¼é€šç”¨ç»„ä»¶åº“
- [ ] è®¾è®¡åœºæ™¯é…ç½® DSL
- [ ] å¼€å‘åœºæ™¯é…ç½®éªŒè¯å·¥å…·

**äº¤ä»˜ç‰©**:
- `src/core/scenario-framework/` - é€šç”¨æ¡†æ¶
- `tools/scenario-validator/` - é…ç½®éªŒè¯å·¥å…·
- åœºæ™¯å¼€å‘æŒ‡å—

#### Week 18-20: ä¼˜åŒ–å’Œæ–‡æ¡£

**ä»»åŠ¡**:
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å¼€å‘è€…æ–‡æ¡£
- [ ] åœºæ™¯æ¨¡æ¿åº“
- [ ] åŸ¹è®­ææ–™

---

## ğŸ“ æŠ€æœ¯æ–¹æ¡ˆè¯¦è§£

### 1. åœºæ™¯æ³¨å†Œè¡¨

```typescript
/**
 * åœºæ™¯æ³¨å†Œè¡¨ - å•ä¾‹æ¨¡å¼
 */
class ScenarioRegistry {
  private scenarios = new Map<string, ScenarioConfig>();
  private current?: string;

  /**
   * æ³¨å†Œåœºæ™¯
   */
  register(config: ScenarioConfig): void {
    // éªŒè¯é…ç½®
    this.validate(config);
    this.scenarios.set(config.id, config);
  }

  /**
   * è·å–å½“å‰åœºæ™¯
   */
  getCurrent(): ScenarioConfig | undefined {
    if (!this.current) return undefined;
    return this.scenarios.get(this.current);
  }

  /**
   * åˆ‡æ¢åœºæ™¯ï¼ˆé€šè¿‡ URL å‚æ•°ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ï¼‰
   */
  switch(scenarioId: string): void {
    if (!this.scenarios.has(scenarioId)) {
      throw new Error(`Scenario ${scenarioId} not found`);
    }
    this.current = scenarioId;
    // è§¦å‘ React Context æ›´æ–°
    this.notifyChange();
  }

  /**
   * éªŒè¯é…ç½®
   */
  private validate(config: ScenarioConfig): void {
    if (!config.id || !config.name) {
      throw new Error('Invalid scenario config');
    }
    // TODO: ä½¿ç”¨ JSON Schema éªŒè¯
  }

  private notifyChange(): void {
    // é€šè¿‡ EventEmitter æˆ– React Context é€šçŸ¥å˜æ›´
  }
}

// å¯¼å‡ºå•ä¾‹
export const scenarioRegistry = new ScenarioRegistry();
```

### 2. React é›†æˆ

```typescript
/**
 * Scenario Context
 */
const ScenarioContext = React.createContext<{
  current?: ScenarioConfig;
  mapper: FieldMapper;
  switch: (id: string) => void;
} | undefined>(undefined);

/**
 * Scenario Provider
 */
export const ScenarioProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [current, setCurrent] = useState(scenarioRegistry.getCurrent());

  useEffect(() => {
    // ç›‘å¬åœºæ™¯å˜æ›´
    const unsubscribe = scenarioRegistry.subscribe(() => {
      setCurrent(scenarioRegistry.getCurrent());
    });
    return unsubscribe;
  }, []);

  const mapper = useMemo(() =>
    current ? new FieldMapper(current) : null,
    [current]
  );

  const switchScenario = useCallback((id: string) => {
    scenarioRegistry.switch(id);
  }, []);

  return (
    <ScenarioContext.Provider value={{ current, mapper, switch: switchScenario }}>
      {children}
    </ScenarioContext.Provider>
  );
};

/**
 * Hook: ä½¿ç”¨åœºæ™¯é…ç½®
 */
export const useScenario = () => {
  const context = useContext(ScenarioContext);
  if (!context) {
    throw new Error('useScenario must be used within ScenarioProvider');
  }
  return context;
};
```

### 3. ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

```typescript
/**
 * é€šç”¨æ–‡æ¡£åˆ—è¡¨é¡µï¼ˆé€‚é…æ‰€æœ‰åœºæ™¯ï¼‰
 */
const GenericDocumentTable: React.FC = () => {
  const { mapper } = useScenario();

  const columns = [
    {
      title: mapper.getFieldLabel('document', 'documentNo'),  // åœºæ™¯åŒ–æ ‡ç­¾
      dataIndex: 'documentNo',                                // å­—æ®µåä¸å˜
      key: 'documentNo',
    },
    {
      title: mapper.getFieldLabel('document', 'dataDate'),
      dataIndex: 'dataDate',
      key: 'dataDate',
    },
    // ...
  ];

  return (
    <ProTable
      columns={columns}
      request={async (params) => {
        // ä½¿ç”¨ç°æœ‰ APIï¼Œæ— éœ€ä¿®æ”¹
        return DocumentService.list(params);
      }}
      // ...
    />
  );
};
```

**ä¼˜åŠ¿**:
- âœ… ä¸€ä¸ªç»„ä»¶é€‚é…æ‰€æœ‰åœºæ™¯
- âœ… ç°æœ‰ API å’Œ Service æ— éœ€ä¿®æ”¹
- âœ… ç±»å‹å®‰å…¨
- âœ… æ€§èƒ½æŸè€—æå°ï¼ˆä»…æ˜ å°„æŸ¥æ‰¾ï¼‰

### 4. åœºæ™¯é…ç½®ç¤ºä¾‹ï¼ˆåŒ»ç–—ï¼‰

```json
{
  "id": "medical",
  "name": "åŒ»ç–—è°ƒç ”",

  "fieldSemantics": {
    "document": {
      "documentNo": "ç—…å†ç¼–å·",
      "dataDate": "å°±è¯Šæ—¥æœŸ",
      "templateName": "ç—…å†æ¨¡æ¿"
    },
    "form": {
      "patient_basic_info": {
        "question_name": "æ‚£è€…å§“å",
        "question_id_number": "èº«ä»½è¯å·",
        "question_age": "å¹´é¾„"
      }
    }
  },

  "terminology": {
    "document": "ç—…å†",
    "form": "è¯Šç–—è¡¨å•",
    "template": "ç—…å†æ¨¡æ¿",
    "create": "åˆ›å»ºç—…å†",
    "edit": "ç¼–è¾‘ç—…å†",
    "submit": "æäº¤ç—…å†"
  },

  "ui": {
    "theme": {
      "primaryColor": "#1890ff",
      "icon": "MedicineBoxOutlined"
    },
    "layout": {
      "tableColumns": ["documentNo", "dataDate", "patientName", "doctor"],
      "searchFields": ["documentNo", "patientName", "dataDate"]
    }
  },

  "roles": {
    "editor": {
      "name": "åŒ»ç”Ÿ",
      "permissions": ["view", "create", "edit", "submit"]
    },
    "viewer": {
      "name": "æŠ¤å£«",
      "permissions": ["view"]
    }
  }
}
```

**å¤§å°**: çº¦ 80 è¡Œï¼Œæ˜“äºç»´æŠ¤ï¼

---

## âš ï¸ é£é™©æ§åˆ¶

### æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| POC å¤±è´¥ | ä¸­ | é«˜ | å¿«é€Ÿè¯•é”™ï¼Œ2å‘¨å³çŸ¥ç»“æœï¼›æœ‰å¤‡é€‰æ–¹æ¡ˆ |
| æ€§èƒ½ä¸‹é™ | ä½ | ä¸­ | å­—æ®µæ˜ å°„æ˜¯ç®€å•æŸ¥æ‰¾ï¼Œæ€§èƒ½å½±å“<5% |
| åœºæ™¯é…ç½®é”™è¯¯ | ä¸­ | ä½ | å¼€å‘é…ç½®éªŒè¯å·¥å…·ï¼Œè¿è¡Œæ—¶æ£€æŸ¥ |

### ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| æ–°åœºæ™¯éœ€æ±‚ä¸æ˜ç¡® | é«˜ | ä¸­ | POC é˜¶æ®µæ·±åº¦è°ƒç ”ï¼Œå¿«é€Ÿè¿­ä»£ |
| ç”¨æˆ·æ¥å—åº¦ä½ | ä½ | ä¸­ | ä¿æŒç°æœ‰åŠŸèƒ½ä¸å˜ï¼Œæ–°åœºæ™¯ç‹¬ç«‹éƒ¨ç½² |

---

## âœ… æˆåŠŸæ ‡å‡†

### é˜¶æ®µ 0 æˆåŠŸæ ‡å‡†ï¼ˆPOCï¼‰

- âœ… POC åœ¨ 4å‘¨å†…å®Œæˆ
- âœ… åŠŸèƒ½å®Œæ•´æ€§ >= 90%
- âœ… æ€§èƒ½æŸè€— < 10%
- âœ… ä»£ç å¤ç”¨ç‡ > 60%
- âœ… ç”¨æˆ·è¯•ç”¨è¯„åˆ† >= 4/5

### é˜¶æ®µ 1 æˆåŠŸæ ‡å‡†ï¼ˆåŒ»ç–—åœºæ™¯ï¼‰

- âœ… 6å‘¨å†…ä¸Šçº¿æµ‹è¯•ç¯å¢ƒ
- âœ… æ”¯æŒå®Œæ•´ä¸šåŠ¡æµç¨‹
- âœ… ç”¨æˆ·æ»¡æ„åº¦ >= 4.5/5
- âœ… æ— ä¸¥é‡ Bug

### æ•´ä½“æˆåŠŸæ ‡å‡†ï¼ˆ20å‘¨åï¼‰

- âœ… æ”¯æŒ 3+ ä¸ªè¡Œä¸šåœºæ™¯
- âœ… æ–°åœºæ™¯å¼€å‘å‘¨æœŸ < 2å‘¨
- âœ… ä»£ç å¤ç”¨ç‡ > 70%
- âœ… ç³»ç»Ÿå¯ç”¨æ€§ > 99.5%
- âœ… ç”¨æˆ·æ»¡æ„åº¦ > 4.5/5

---

## ğŸ“š æ–‡æ¡£ç»“æ„

```
docs/
â”œâ”€â”€ TRANSFORMATION_OVERVIEW.md        # æœ¬æ–‡æ¡£ - æ€»è§ˆï¼ˆv2.0ï¼‰
â”œâ”€â”€ v2/                               # v2.0 è¯¦ç»†æ–¹æ¡ˆ
â”‚   â”œâ”€â”€ 01-scenario-adapter.md        # åœºæ™¯é€‚é…å±‚è®¾è®¡
â”‚   â”œâ”€â”€ 02-field-mapping.md           # å­—æ®µæ˜ å°„æœºåˆ¶
â”‚   â”œâ”€â”€ 03-poc-guide.md               # POC å®æ–½æŒ‡å—
â”‚   â”œâ”€â”€ 04-scenario-config-spec.md    # åœºæ™¯é…ç½®è§„èŒƒ
â”‚   â””â”€â”€ 05-testing-strategy.md        # æµ‹è¯•ç­–ç•¥
â”œâ”€â”€ deprecated/                       # å·²åºŸå¼ƒçš„ v1.0 æ–¹æ¡ˆ
â”‚   â”œâ”€â”€ generic-data-model.md         # å·²åºŸå¼ƒ
â”‚   â”œâ”€â”€ universal-transformation-plan.md  # å·²åºŸå¼ƒ
â”‚   â””â”€â”€ form-template-refactor.md     # å·²åºŸå¼ƒ
â””â”€â”€ README.md                         # æ–‡æ¡£ç´¢å¼•
```

---

## ğŸ”„ ä¸ v1.0 æ–¹æ¡ˆçš„å¯¹æ¯”

| ç»´åº¦ | v1.0 æ–¹æ¡ˆ | v2.0 æ–¹æ¡ˆ |
|------|-----------|-----------|
| **æ•°æ®æ¨¡å‹** | é‡å†™ä¸º Entity | ä¿æŒ Document/Form |
| **å®æ–½ç­–ç•¥** | æ¨å€’é‡æ¥ | POC + æ¸è¿›å¼ |
| **æ—¶é—´ä¼°ç®—** | 16å‘¨ | POC 4å‘¨ + æ¯åœºæ™¯ 4-6å‘¨ |
| **æ•°æ®è¿ç§»** | å…¨é‡è¿ç§» | é›¶è¿ç§» |
| **é£é™©** | é«˜ | ä½-ä¸­ |
| **å‘åå…¼å®¹** | é€šè¿‡é€‚é…å™¨ï¼ˆä¸å¯é ï¼‰ | 100% å…¼å®¹ |
| **é…ç½®å¤æ‚åº¦** | 1677è¡Œ/åœºæ™¯ | 50-150è¡Œ/åœºæ™¯ |
| **æŠ€æœ¯å€ºåŠ¡** | å¼•å…¥å¤§é‡æ–°æŠ½è±¡ | æœ€å°åŒ–æ–°æ¦‚å¿µ |
| **å¯è¡Œæ€§** | ä½ | é«˜ |

---

## ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿

### v2.0 æ–¹æ¡ˆçš„å…³é”®ä¼˜åŠ¿

1. **é›¶é£é™©å¯åŠ¨**
   - POC åªéœ€ 4å‘¨
   - ä¸å½±å“ç°æœ‰ç³»ç»Ÿ
   - å¤±è´¥æˆæœ¬ä½

2. **å¿«é€Ÿè§æ•ˆ**
   - ç¬¬ 4å‘¨ çœ‹åˆ° POC æˆæœ
   - ç¬¬ 10å‘¨ ç¬¬ä¸€ä¸ªåœºæ™¯ä¸Šçº¿
   - ç¬¬ 14å‘¨ ç¬¬äºŒä¸ªåœºæ™¯ä¸Šçº¿

3. **æŠ€æœ¯ç®€å•**
   - æ²¡æœ‰å¤æ‚çš„æŠ½è±¡å±‚
   - æ²¡æœ‰æ•°æ®è¿ç§»
   - æ˜“äºç†è§£å’Œç»´æŠ¤

4. **ä¸šåŠ¡çµæ´»**
   - é…ç½®ç®€å•ï¼ˆ50-150è¡Œï¼‰
   - å¼€å‘å¿«é€Ÿï¼ˆ1-2å‘¨ï¼‰
   - æ˜“äºè°ƒæ•´

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨

1. **è¯„å®¡æœ¬æ–¹æ¡ˆ** - æŠ€æœ¯å›¢é˜Ÿè¯„å®¡ï¼Œç¡®è®¤å¯è¡Œæ€§
2. **é€‰æ‹© POC åœºæ™¯** - é€‰æ‹©ä¸€ä¸ªç®€å•çš„æ–°ä¸šåŠ¡åœºæ™¯
3. **ç»„å»º POC å›¢é˜Ÿ** - 1-2 åå¼€å‘ï¼Œ1 åäº§å“
4. **å¯åŠ¨ POC** - 4å‘¨å†²åˆº

### Week 1 ä»»åŠ¡æ¸…å•

- [ ] å®Œæˆ POC åœºæ™¯éœ€æ±‚è°ƒç ”
- [ ] è®¾è®¡ ScenarioConfig æ•°æ®ç»“æ„
- [ ] å®ç° FieldMapper æ ¸å¿ƒé€»è¾‘
- [ ] æ­å»º POC é¡µé¢æ¡†æ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-14
**ä½œè€…**: å¼€å‘å›¢é˜Ÿ
**çŠ¶æ€**: å¾…è¯„å®¡

---

## é™„å½•: æ¦‚å¿µå¯¹ç…§è¡¨

| æ¦‚å¿µ | è¯´æ˜ | æ•°æ®è¡¨ | TypeScript ç±»å‹ |
|------|------|--------|----------------|
| **Document** | æ–‡æ¡£å®ä¾‹ï¼ˆå®¹å™¨ï¼‰ | documents | DocumentType |
| **Form** | è¡¨å•å®ä¾‹ï¼ˆçœŸæ­£çš„æ•°æ®ï¼‰ | forms | FormType |
| **FormSection** | è¡¨å•åŒºå— | form_sections | FormSectionType |
| **FormQuestion** | è¡¨å•é—®é¢˜/å­—æ®µ | form_questions | FormQuestionType |
| **DocumentTemplate** | æ–‡æ¡£æ¨¡æ¿ | document_templates | DocumentTemplateType |
| **FormTemplate** | è¡¨å•æ¨¡æ¿ | form_templates | FormTemplateType |
| **Scenario** | åœºæ™¯ï¼ˆæ–°å¢ï¼Œé…ç½®å±‚ï¼‰ | æ— ï¼ˆJSON é…ç½®ï¼‰ | ScenarioConfig |
| **FieldMapper** | å­—æ®µæ˜ å°„å™¨ï¼ˆæ–°å¢ï¼‰ | æ— ï¼ˆè¿è¡Œæ—¶ï¼‰ | FieldMapper |

**å…³é”®ç‚¹**: v2.0 æ²¡æœ‰å¼•å…¥æ–°çš„æ•°æ®åº“è¡¨ï¼Œåªåœ¨åº”ç”¨å±‚å¢åŠ é…ç½®å’Œé€‚é…ã€‚
